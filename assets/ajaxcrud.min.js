/*!
 * Ajax Crud 
 * =================================
 * Use for johnitvn/yii2-ajaxcrud extension
 */!function(t){function e(){t(f).modal("toggle")}function a(a){var o=t.extend({type:"default",title:"",closeButton:!0,loading:!0,url:"create",method:"GET",positiveButton:null,negativeButton:null,onPositiveClick:null,onNegativeClick:null},a);t(f).find(".modal-dialog").addClass("modal-"+o.type),o.loading&&(t(f).find(".modal-header .modal-title").remove(),t(f).find(".modal-header").append('<div class="modal-title"><h4 class="modal-title">Loading</h4></div>'),t(f).find(".modal-body").html('<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>')),o.closeButton||t(f).find(".modal-title button.close").remove(),t(f).modal(),t.ajax({url:o.url,method:o.method,success:function(a){t(f).find(".modal-header .modal-title").remove(),t(f).find(".modal-header").append('<div class="modal-title"><h4 class="modal-title">'+o.title+"</h4></div>"),t(f).find(".modal-body").html(a.data),(null!=o.positiveButton||null!=o.negativeButton)&&(modalFooter=document.createElement("div"),modalFooter.setAttribute("class","modal-footer"),t(f).find(".modal-content").append(modalFooter),null!=o.positiveButton&&(positiveButtonElm=document.createElement("button"),positiveButtonElm.setAttribute("class","btn btn-primary"),positiveButtonElm.innerHTML=o.positiveButton,t(modalFooter).append(positiveButtonElm),null!=o.onPositiveClick&&t(positiveButtonElm).click(function(t){o.onPositiveClick(t)})),null!=o.negativeButton&&(negativeButtonElm=document.createElement("button"),negativeButtonElm.setAttribute("class","btn btn-default pull-left"),negativeButtonElm.innerHTML=o.negativeButton,t(modalFooter).append(negativeButtonElm),t(negativeButtonElm).click(function(t){e(),null!=o.onNegativeClick&&o.onNegativeClick(t)}))),t(this).find("form").submit(function(t){t.preventDefault()})}})}function o(){$modalDialog=t(f).find(".modal-dialog"),$modalDialog.attr("class",""),$modalDialog.addClass("modal-dialog"),t(f).find(".modal-footer").remove(),t(f).find(".modal-body").html(""),t(f).find(".modal-title").html("")}function i(){t.pjax.reload({container:p})}function l(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function n(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function d(e){e.preventDefault(),a({url:t(b).attr("href"),title:t(b).hasAttr("data-modal-title")?t(b).attr("data-modal-title"):"Create new",positiveButton:t(b).hasAttr("data-modal-positive")?t(b).attr("data-modal-positive"):"Save",negativeButton:t(b).hasAttr("data-modal-negative")?t(b).attr("data-modal-negative"):"Cancel",onPositiveClick:h})}function s(a){return a.preventDefault(),confirm(t(this).attr("data-confirm-message"))&&(t(f).find(".modal-header .modal-title").remove(),t(f).find(".modal-header").append('<div class="modal-title"><h4 class="modal-title">Loading</h4></div>'),t(f).find(".modal-body").html('<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>'),t(f).modal(),t.ajax({url:t(this).attr("href"),method:t(this).attr("data-method"),success:function(){i(),e()}})),!1}function r(e){e.preventDefault(),a({url:t(this).attr("href"),title:t(this).hasAttr("data-modal-title")?t(this).attr("data-modal-title"):"View",negativeButton:t(this).hasAttr("data-modal-negative")?t(this).attr("data-modal-negative"):"Close"})}function c(e){e.preventDefault(),a({url:t(this).attr("href"),title:t(this).hasAttr("data-modal-title")?t(this).attr("data-modal-title"):"Update",positiveButton:t(this).hasAttr("data-modal-positive")?t(this).attr("data-modal-positive"):"Save",negativeButton:t(this).hasAttr("data-modal-negative")?t(this).attr("data-modal-negative"):"Cancel",onPositiveClick:v})}function m(a){a.preventDefault();var o=[];return t('input:checkbox[name="selection[]"]').each(function(){this.checked&&o.push(t(this).val())}),0==o.length?!1:(confirm(t(k).attr("data-confirm-message"))&&(t(f).find(".modal-header .modal-title").remove(),t(f).find(".modal-header").append('<div class="modal-title"><h4 class="modal-title">Loading</h4></div>'),t(f).find(".modal-body").html('<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>'),t(f).modal(),t.ajax({url:t(k).attr("href"),method:t(k).attr("data-method"),data:{pks:JSON.stringify(o)},success:function(){i(),e()}})),!1)}function u(){t(this).find("i").hasClass("glyphicon-resize-full")?(l(document.getElementById(p.substring(1))),t(this).find("i").removeClass("glyphicon-resize-full"),t(this).find("i").addClass("glyphicon-resize-small"),t(b).addClass("hidden")):(n(),t(this).find("i").removeClass("glyphicon-resize-small"),t(this).find("i").addClass("glyphicon-resize-full"),t(b).removeClass("hidden"))}function v(){var e=t(f).find("form");t.ajax({url:t(e).attr("action"),method:t(e).attr("method"),data:t(e).serialize(),success:function(e){200==e.code?(i(),t(f).find(".modal-dialog").addClass("modal-success"),t(f).find(".modal-body").html(e.message),$successNegativeButton=t(C).hasAttr("data-modal-negative-success")?t(this).attr("data-modal-negative-success"):"Close",t(f).find(".modal-footer .btn-default").html($successNegativeButton),t(f).find(".modal-footer .btn-primary").remove()):400==e.code&&t(f).find(".modal-body").html(e.data)}})}function h(){var e=t(f).find("form");t.ajax({url:t(e).attr("action"),method:t(e).attr("method"),data:t(e).serialize(),success:function(e){200==e.code?(i(),t(f).find(".modal-dialog").addClass("modal-success"),t(f).find(".modal-body").html(e.message),$successNegativeButton=t(b).hasAttr("data-modal-negative-success")?t(this).attr("data-modal-negative-success"):"Close",t(f).find(".modal-footer .btn-default").html($successNegativeButton),$successPositiveButton=t(b).hasAttr("data-modal-positive-success")?t(this).attr("data-modal-positive-success"):"Create other",t(f).find(".modal-footer .btn-primary").html($successPositiveButton),t(f).find(".modal-footer .btn-primary").click(function(t){o(),d(t)})):400==e.code&&t(f).find(".modal-body").html(e.data)}})}var f="#ajaxCrubModal",g="#ajaxCrudDatatable",p="#crud-datatable-pjax",b=".create-action-button",B=".delete-action-button",C=".update-action-button",y=".view-action-button",k=".btn-bulk-delete",F=".btn-toggle-fullscreen";t.fn.hasAttr=function(t){return void 0!==this.attr(t)},t(g).on("click",b,d),t(g).on("click",B,s),t(g).on("click",y,r),t(g).on("click",C,c),t(g).on("click",k,m),t(g).on("click",F,u),t(f).on("hidden.bs.modal",o)}(jQuery);
